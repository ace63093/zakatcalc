{% extends "base.html" %}

{% block title %}Zakat Calculator - Calculate Your Islamic Wealth Tax{% endblock %}

{% block head %}
<meta name="description" content="Use the Zakat Calculator to compute your Islamic wealth obligation. Enter gold, cash, savings, crypto, and investments to calculate 2.5% Zakat.">
<link rel="stylesheet" href="{{ url_for('static', filename='css/autocomplete.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/nisab-indicator.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/tools.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/advanced-assets.css') }}">
{% if feature_flags.date_assistant_enabled %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/date-assistant.css') }}">
{% endif %}
{% endblock %}

{% block content %}
<div class="container">
    <h1>Zakat Calculator</h1>
    <p class="subtitle">Calculate your Islamic wealth obligation (2.5%)</p>

    <div class="info-box">
        <p><strong>Nisab Threshold:</strong> Zakat is obligatory when your wealth exceeds the Nisab
        (equivalent to 85g of gold or 595g of silver). Enter your assets below to calculate.</p>
    </div>

    <!-- Cadence Info Banner - shows effective snapshot date and cadence type -->
    <div id="cadenceBanner" class="cadence-banner" style="display: none;">
        <div class="cadence-banner-content">
            <span class="cadence-banner-icon">i</span>
            <span class="cadence-banner-message">
                Using <strong id="cadenceType">weekly</strong> snapshot from <strong id="cadenceEffectiveDate"></strong>.
                <span id="cadenceNote" class="cadence-note"></span>
            </span>
        </div>
    </div>

    <!-- Two-column layout wrapper (desktop: inputs left, results right) -->
    <div class="calculator-layout app-grid">
        <!-- Left column: Input Form -->
        <div class="calculator-inputs main">
            <form id="zakatForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="baseCurrency">Base Currency</label>
                        <div id="baseCurrencyContainer" class="currency-autocomplete" data-name="baseCurrency"></div>
                        <p class="hint">All values will be converted to this currency</p>
                    </div>

                    <div class="form-group">
                        <label for="calculationDate">Calculation Date</label>
                        <input type="date" id="calculationDate" name="calculationDate">
                        <p class="hint">Historical prices will be used for this date</p>
                    </div>
                </div>

                <div id="effectiveDate" class="effective-date-notice" style="display: none;"></div>

                <!-- Gold Assets -->
                <div class="section-title">Gold Assets</div>
                <div id="goldItems">
                    <div class="asset-row" data-type="gold">
                        <div class="group-name">
                            <input type="text" name="gold_name" placeholder="Name (e.g., Ring)" class="input-name">
                        </div>
                        <div class="group-middle">
                            <input type="number" name="gold_weight" step="0.0001" min="0" placeholder="Weight" class="input-weight">
                        </div>
                        <div class="group-middle-secondary">
                            <select name="gold_weight_unit" class="input-weight-unit">
                                <option value="g" selected>g</option>
                                <option value="ozt">oz t</option>
                                <option value="tola">tola</option>
                                <option value="vori">vori</option>
                                <option value="aana">aana</option>
                            </select>
                            <select name="gold_karat" class="input-karat">
                                <option value="24">24K</option>
                                <option value="22" selected>22K</option>
                                <option value="21">21K</option>
                                <option value="18">18K</option>
                                <option value="14">14K</option>
                                <option value="10">10K</option>
                                <option value="9">9K</option>
                            </select>
                        </div>
                        <div class="group-value">
                            <span class="weight-grams-pill" data-field="weight_grams">—</span>
                            <span class="base-value-pill pill-empty" data-field="base_value">—</span>
                        </div>
                        <div class="group-remove">
                            <button type="button" class="btn-remove" onclick="removeRow(this)">−</button>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn-add" onclick="addGoldRow()">+ Add Gold Item</button>

                <!-- Other Precious Metals -->
                <div class="section-title">Other Precious Metals
                    <span class="section-note" title="Silver is unanimously zakatable. Platinum and palladium are not universally considered zakatable by all scholars; they are included here as trade goods for those who follow that opinion.">?</span>
                </div>
                <div id="metalItems">
                    <div class="asset-row" data-type="metal">
                        <div class="group-name">
                            <input type="text" name="metal_name" placeholder="Name (e.g., Silver coins)" class="input-name">
                        </div>
                        <div class="group-middle">
                            <input type="number" name="metal_weight" step="0.0001" min="0" placeholder="Weight" class="input-weight">
                        </div>
                        <div class="group-middle-secondary">
                            <select name="metal_weight_unit" class="input-weight-unit">
                                <option value="g" selected>g</option>
                                <option value="ozt">oz t</option>
                                <option value="tola">tola</option>
                                <option value="vori">vori</option>
                                <option value="aana">aana</option>
                            </select>
                            <select name="metal_type" class="input-metal">
                                <option value="silver">Silver</option>
                                <option value="platinum">Platinum</option>
                                <option value="palladium">Palladium</option>
                            </select>
                        </div>
                        <div class="group-value">
                            <span class="weight-grams-pill" data-field="weight_grams">—</span>
                            <span class="base-value-pill pill-empty" data-field="base_value">—</span>
                        </div>
                        <div class="group-remove">
                            <button type="button" class="btn-remove" onclick="removeRow(this)">−</button>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn-add" onclick="addMetalRow()">+ Add Metal Item</button>

                <!-- Cash on Hand -->
                <div class="section-title">Cash on Hand</div>
                <div id="cashItems">
                    <div class="asset-row" data-type="cash">
                        <div class="group-name">
                            <input type="text" name="cash_name" placeholder="Name (e.g., Wallet)" class="input-name">
                        </div>
                        <div class="group-middle">
                            <input type="number" name="cash_amount" step="0.01" min="0" placeholder="Amount" class="input-amount">
                            <div class="currency-autocomplete" data-name="cash_currency"></div>
                        </div>
                        <div class="group-value">
                            <span class="base-value-pill pill-empty" data-field="base_value">—</span>
                        </div>
                        <div class="group-remove">
                            <button type="button" class="btn-remove" onclick="removeRow(this)">−</button>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn-add" onclick="addCashRow()">+ Add Cash Item</button>

                <!-- Investment and Banking Accounts -->
                <div class="section-title">Investment and Banking Accounts</div>
                <p class="section-helper">Enter the balances of your respective accounts.</p>
                <div id="bankItems">
                    <div class="asset-row" data-type="bank">
                        <div class="group-name">
                            <input type="text" name="bank_name" placeholder="Name (e.g., Savings)" class="input-name">
                        </div>
                        <div class="group-middle">
                            <input type="number" name="bank_amount" step="0.01" min="0" placeholder="Amount" class="input-amount">
                            <div class="currency-autocomplete" data-name="bank_currency"></div>
                        </div>
                        <div class="group-value">
                            <span class="base-value-pill pill-empty" data-field="base_value">—</span>
                        </div>
                        <div class="group-remove">
                            <button type="button" class="btn-remove" onclick="removeRow(this)">−</button>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn-add" onclick="addBankRow()">+ Add Account</button>

                <!-- Cryptocurrency -->
                <div class="section-title">Cryptocurrency</div>
                <div id="cryptoItems">
                    <div class="asset-row" data-type="crypto">
                        <div class="group-name">
                            <input type="text" name="crypto_name" placeholder="Name (e.g., Holdings)" class="input-name">
                        </div>
                        <div class="group-middle">
                            <div class="crypto-autocomplete" data-name="crypto_symbol"></div>
                        </div>
                        <div class="group-middle-secondary">
                            <input type="number" name="crypto_amount" step="0.00000001" min="0" placeholder="Amount" class="input-amount">
                        </div>
                        <div class="group-value">
                            <span class="base-value-pill pill-empty" data-field="base_value">—</span>
                        </div>
                        <div class="group-remove">
                            <button type="button" class="btn-remove" onclick="removeRow(this)">−</button>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn-add" onclick="addCryptoRow()">+ Add Crypto Asset</button>

                {% if feature_flags.advanced_assets_enabled %}
                <!-- Advanced Mode Toggle -->
                <div class="advanced-mode-toggle">
                    <label class="toggle-switch">
                        <input type="checkbox" id="advancedModeToggle">
                        <span class="toggle-slider"></span>
                    </label>
                    <span class="toggle-label">Advanced Assets Mode</span>
                    <span class="toggle-hint">Include stocks, retirement accounts, receivables, business inventory, and investment property</span>
                </div>

                <!-- Advanced Assets Sections (hidden by default) -->
                <div id="advancedAssetsContainer" class="advanced-assets-container" style="display: none;">

                    <!-- Stocks / ETFs -->
                    <div class="section-title section-title-advanced">Stocks / ETFs</div>
                    <p class="section-helper">Enter your stock and ETF holdings. Choose valuation method per holding.</p>
                    <div id="stockItems">
                        <div class="asset-row" data-type="stock">
                            <div class="group-name">
                                <input type="text" name="stock_name" placeholder="Name (e.g., VGRO)" class="input-name">
                            </div>
                            <div class="group-middle">
                                <input type="number" name="stock_value" step="0.01" min="0" placeholder="Value" class="input-amount">
                                <div class="currency-autocomplete" data-name="stock_currency"></div>
                            </div>
                            <div class="group-middle-secondary">
                                <select name="stock_method" class="input-method">
                                    <option value="market_value" selected>Full Value</option>
                                    <option value="zakatable_portion">30% Only</option>
                                </select>
                            </div>
                            <div class="group-value">
                                <span class="base-value-pill pill-empty" data-field="base_value">—</span>
                            </div>
                            <div class="group-remove">
                                <button type="button" class="btn-remove" onclick="removeRow(this)">−</button>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn-add" onclick="addStockRow()">+ Add Stock/ETF</button>

                    <!-- Retirement Accounts -->
                    <div class="section-title section-title-advanced">Retirement Accounts</div>
                    <p class="section-helper">RRSP, 401(k), IRA, etc. Choose how to value based on accessibility.</p>
                    <div id="retirementItems">
                        <div class="asset-row" data-type="retirement">
                            <div class="group-name">
                                <input type="text" name="retirement_name" placeholder="Name (e.g., RRSP)" class="input-name">
                            </div>
                            <div class="group-middle">
                                <input type="number" name="retirement_balance" step="0.01" min="0" placeholder="Balance" class="input-amount">
                                <div class="currency-autocomplete" data-name="retirement_currency"></div>
                            </div>
                            <div class="group-middle-secondary">
                                <select name="retirement_method" class="input-method">
                                    <option value="accessible_only" selected>If Accessible</option>
                                    <option value="full_balance">Full Balance</option>
                                    <option value="penalty_adjusted">After 10% Penalty</option>
                                </select>
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="retirement_accessible" checked> Accessible
                                </label>
                            </div>
                            <div class="group-value">
                                <span class="base-value-pill pill-empty" data-field="base_value">—</span>
                            </div>
                            <div class="group-remove">
                                <button type="button" class="btn-remove" onclick="removeRow(this)">−</button>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn-add" onclick="addRetirementRow()">+ Add Retirement Account</button>

                    <!-- Receivables -->
                    <div class="section-title section-title-advanced">Receivables</div>
                    <p class="section-helper">Money owed to you. Only "likely" receivables are included by default.</p>
                    <div id="receivableItems">
                        <div class="asset-row" data-type="receivable">
                            <div class="group-name">
                                <input type="text" name="receivable_name" placeholder="Name (e.g., Client A)" class="input-name">
                            </div>
                            <div class="group-middle">
                                <input type="number" name="receivable_amount" step="0.01" min="0" placeholder="Amount" class="input-amount">
                                <div class="currency-autocomplete" data-name="receivable_currency"></div>
                            </div>
                            <div class="group-middle-secondary">
                                <select name="receivable_likelihood" class="input-likelihood">
                                    <option value="likely" selected>Likely</option>
                                    <option value="uncertain">Uncertain</option>
                                    <option value="doubtful">Doubtful</option>
                                </select>
                            </div>
                            <div class="group-value">
                                <span class="base-value-pill pill-empty" data-field="base_value">—</span>
                            </div>
                            <div class="group-remove">
                                <button type="button" class="btn-remove" onclick="removeRow(this)">−</button>
                            </div>
                        </div>
                    </div>
                    <div class="receivables-options">
                        <label class="checkbox-inline">
                            <input type="checkbox" id="includeUncertainReceivables"> Include uncertain receivables at 50%
                        </label>
                    </div>
                    <button type="button" class="btn-add" onclick="addReceivableRow()">+ Add Receivable</button>

                    <!-- Business Inventory -->
                    <div class="section-title section-title-advanced">Business Inventory</div>
                    <p class="section-helper">Trade goods and inventory held for resale. Personal-use items are exempt.</p>
                    <div id="businessInventory" class="business-inventory-section">
                        <div class="business-row">
                            <label>Business Name</label>
                            <input type="text" name="business_name" placeholder="Business name">
                        </div>
                        <div class="business-row">
                            <label>Inventory Resale Value</label>
                            <div class="business-input-group">
                                <input type="number" name="business_resale_value" step="0.01" min="0" placeholder="0.00">
                                <div class="currency-autocomplete" data-name="business_currency"></div>
                            </div>
                        </div>
                        <div class="business-row">
                            <label>Business Cash</label>
                            <input type="number" name="business_cash" step="0.01" min="0" placeholder="0.00">
                        </div>
                        <div class="business-row">
                            <label>Business Receivables</label>
                            <input type="number" name="business_receivables" step="0.01" min="0" placeholder="0.00">
                        </div>
                        <div class="business-row">
                            <label>Business Payables</label>
                            <input type="number" name="business_payables" step="0.01" min="0" placeholder="0.00">
                        </div>
                        <div class="business-subtotal">
                            <span>Net Business Value:</span>
                            <span class="base-value-pill pill-empty" id="businessSubtotal">—</span>
                        </div>
                    </div>

                    <!-- Investment Property -->
                    <div class="section-title section-title-advanced">Investment Property</div>
                    <p class="section-helper">Properties held for income or resale. Primary residence is exempt.</p>
                    <div id="propertyItems">
                        <div class="asset-row" data-type="property">
                            <div class="group-name">
                                <input type="text" name="property_name" placeholder="Name (e.g., Rental Unit)" class="input-name">
                            </div>
                            <div class="group-middle">
                                <input type="number" name="property_market_value" step="0.01" min="0" placeholder="Market Value" class="input-amount">
                                <div class="currency-autocomplete" data-name="property_currency"></div>
                            </div>
                            <div class="group-middle-secondary">
                                <select name="property_intent" class="input-intent">
                                    <option value="rental" selected>Rental Income</option>
                                    <option value="resale">For Resale</option>
                                </select>
                            </div>
                            <div class="group-value">
                                <span class="base-value-pill pill-empty" data-field="base_value">—</span>
                            </div>
                            <div class="group-remove">
                                <button type="button" class="btn-remove" onclick="removeRow(this)">−</button>
                            </div>
                        </div>
                    </div>
                    <p class="section-helper property-rental-note" id="propertyRentalNote" style="display: none;">
                        For rental properties, enter saved rental income (not market value) to be included in zakat calculation.
                    </p>
                    <button type="button" class="btn-add" onclick="addPropertyRow()">+ Add Property</button>

                </div>
                {% endif %}

                <!-- Debts (Deductible) -->
                <div class="section-title section-title-debts">Debts (Deductible)</div>
                <p class="section-helper">Deductible debts reduce your zakat-eligible total.</p>

                {% if feature_flags.advanced_assets_enabled %}
                <!-- Debt Policy Selector (Advanced Mode) -->
                <div id="debtPolicyContainer" class="debt-policy-container" style="display: none;">
                    <label for="debtPolicy">Debt Deduction Policy:</label>
                    <select id="debtPolicy" name="debt_policy" class="input-policy">
                        <option value="12_months" selected>Next 12 months only</option>
                        <option value="total">Total outstanding</option>
                    </select>
                    <span class="policy-hint" id="policyHint">Only debts due within the next year are deducted</span>
                </div>
                {% endif %}

                <!-- Credit Cards subsection -->
                <div class="subsection-title">Credit Cards</div>
                <div id="creditCardItems">
                    <div class="asset-row" data-type="credit_card">
                        <div class="group-name">
                            <input type="text" name="credit_card_name" placeholder="Name (e.g., Visa)" class="input-name">
                        </div>
                        <div class="group-middle">
                            <input type="number" name="credit_card_amount" step="0.01" min="0" placeholder="Balance" class="input-amount">
                            <div class="currency-autocomplete" data-name="credit_card_currency"></div>
                        </div>
                        <div class="group-value">
                            <span class="base-value-pill pill-empty" data-field="base_value">—</span>
                        </div>
                        <div class="group-remove">
                            <button type="button" class="btn-remove" onclick="removeRow(this)">−</button>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn-add" onclick="addCreditCardRow()">+ Add Credit Card</button>

                <!-- Recurring Loans subsection -->
                <div class="subsection-title">Recurring Loans</div>
                <p class="section-helper">Enter your regular payment amount. Annual total will be calculated automatically.</p>
                <div id="loanItems">
                    <div class="asset-row" data-type="loan">
                        <div class="group-name">
                            <input type="text" name="loan_name" placeholder="Name (e.g., Car Loan)" class="input-name">
                        </div>
                        <div class="group-middle">
                            <input type="number" name="loan_payment_amount" step="0.01" min="0" placeholder="Payment" class="input-amount">
                        </div>
                        <div class="group-middle-secondary">
                            <select name="loan_frequency" class="input-frequency">
                                <option value="monthly" selected>Monthly</option>
                                <option value="weekly">Weekly</option>
                                <option value="biweekly">Bi-weekly</option>
                                <option value="semi_monthly">Semi-monthly</option>
                                <option value="quarterly">Quarterly</option>
                                <option value="yearly">Yearly</option>
                            </select>
                            <div class="currency-autocomplete" data-name="loan_currency"></div>
                        </div>
                        <div class="group-value">
                            <span class="base-value-pill pill-empty" data-field="base_value" title="Annualized amount in base currency">—</span>
                        </div>
                        <div class="group-remove">
                            <button type="button" class="btn-remove" onclick="removeRow(this)">−</button>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn-add" onclick="addLoanRow()">+ Add Loan</button>

                {% if feature_flags.advanced_assets_enabled %}
                <!-- Short-term Payables subsection (Advanced Mode) -->
                <div id="shortTermPayablesContainer" class="short-term-payables-container" style="display: none;">
                    <div class="subsection-title">Short-term Payables</div>
                    <p class="section-helper">Taxes, rent, utilities, and other bills due soon.</p>
                    <div id="payableItems">
                        <div class="asset-row" data-type="payable">
                            <div class="group-name">
                                <input type="text" name="payable_name" placeholder="Name (e.g., Income Tax)" class="input-name">
                            </div>
                            <div class="group-middle">
                                <input type="number" name="payable_amount" step="0.01" min="0" placeholder="Amount" class="input-amount">
                                <div class="currency-autocomplete" data-name="payable_currency"></div>
                            </div>
                            <div class="group-middle-secondary">
                                <select name="payable_type" class="input-payable-type">
                                    <option value="taxes" selected>Taxes</option>
                                    <option value="rent">Rent</option>
                                    <option value="utilities">Utilities</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="group-value">
                                <span class="base-value-pill pill-empty" data-field="base_value">—</span>
                            </div>
                            <div class="group-remove">
                                <button type="button" class="btn-remove" onclick="removeRow(this)">−</button>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn-add" onclick="addPayableRow()">+ Add Payable</button>
                </div>
                {% endif %}

                <!-- Tools Section -->
                <div class="tools-section">
                    <h3>Tools</h3>
                    <div class="tools-buttons">
                        <button type="button" id="share-link-btn">Copy Share Link</button>
                        <button type="button" id="export-csv-btn">Export CSV</button>
                        {% if feature_flags.print_summary_enabled %}
                        <button type="button" id="print-summary-btn">Print Summary</button>
                        {% endif %}
                    </div>
                </div>
            </form>
        </div>

        <!-- Right column: Results Panel (sticky on desktop) -->
        <div class="calculator-results sidebar">
            {% if feature_flags.date_assistant_enabled %}
            <!-- Zakat Date Assistant -->
            <div id="dateAssistantContainer"></div>
            {% endif %}

            <!-- Nisab Indicator Card -->
            <div id="nisabIndicatorContainer"></div>

            <div id="result" class="result show">
                <h2>Calculation Results</h2>

                <div class="result-section">
                    <h3>Asset Subtotals</h3>
                    <div class="result-row">
                        <span class="result-label">Gold Total</span>
                        <span class="result-value" id="goldTotal">$0.00</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Other Metals Total</span>
                        <span class="result-value" id="metalTotal">$0.00</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Cash Total</span>
                        <span class="result-value" id="cashTotal">$0.00</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Accounts Total</span>
                        <span class="result-value" id="bankTotal">$0.00</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Crypto Total</span>
                        <span class="result-value" id="cryptoTotal">$0.00</span>
                    </div>
                    <!-- Advanced Assets Subtotals (hidden by default) -->
                    <div id="advancedSubtotals" class="advanced-subtotals" style="display: none;">
                        <div class="result-row">
                            <span class="result-label">Stocks/ETFs Total</span>
                            <span class="result-value" id="stockTotal">$0.00</span>
                        </div>
                        <div class="result-row">
                            <span class="result-label">Retirement Total</span>
                            <span class="result-value" id="retirementTotal">$0.00</span>
                        </div>
                        <div class="result-row">
                            <span class="result-label">Receivables Total</span>
                            <span class="result-value" id="receivablesTotal">$0.00</span>
                        </div>
                        <div class="result-row">
                            <span class="result-label">Business Total</span>
                            <span class="result-value" id="businessTotal">$0.00</span>
                        </div>
                        <div class="result-row">
                            <span class="result-label">Property Total</span>
                            <span class="result-value" id="propertyTotal">$0.00</span>
                        </div>
                    </div>
                </div>

                <div class="result-section">
                    <h3>Zakat Calculation</h3>
                    <div class="result-row">
                        <span class="result-label">Assets Total</span>
                        <span class="result-value" id="grandTotal">$0.00</span>
                    </div>
                    <div class="result-row debts-row">
                        <span class="result-label">Debts Total</span>
                        <span class="result-value result-value-deduction" id="debtsTotal">−$0.00</span>
                    </div>
                    <div class="result-row grand-total">
                        <span class="result-label">Net Total</span>
                        <span class="result-value" id="netTotal">$0.00</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label" id="nisabThresholdLabel">Nisab Threshold (85g Gold)</span>
                        <span class="result-value" id="nisabThreshold">$0.00</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Above Nisab</span>
                        <span class="result-value" id="aboveNisab">-</span>
                    </div>
                    <div class="result-row zakat-row">
                        <span class="result-label"><span class="zakat-due-label">Zakat Due (2.5%)</span></span>
                        <span class="result-value"><span class="zakat-due-value" id="zakatDue">$0.00</span></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/utils/shared.js') }}"></script>
<script src="{{ url_for('static', filename='js/vendor/lz-string.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/components/currency-autocomplete.js') }}"></script>
<script src="{{ url_for('static', filename='js/components/crypto-autocomplete.js') }}"></script>
<script src="{{ url_for('static', filename='js/components/nisab-indicator.js') }}"></script>
<script src="{{ url_for('static', filename='js/components/share-link.js') }}"></script>
<script src="{{ url_for('static', filename='js/components/csv-export.js') }}"></script>
{% if feature_flags.autosave_enabled %}
<script src="{{ url_for('static', filename='js/components/autosave.js') }}"></script>
{% endif %}
{% if feature_flags.date_assistant_enabled %}
<script src="{{ url_for('static', filename='js/components/date-assistant.js') }}"></script>
{% endif %}
<script src="{{ url_for('static', filename='js/calculator.js') }}"></script>
<script>
    // Initialize ShareLink and CsvExport after calculator is ready
    document.addEventListener('DOMContentLoaded', function() {
        ShareLink.init();
        CsvExport.init();
        {% if feature_flags.autosave_enabled %}
        Autosave.init(true);
        {% endif %}
        {% if feature_flags.date_assistant_enabled %}
        ZakatDateAssistant.init('dateAssistantContainer');
        {% endif %}
    });
</script>
{% endblock %}
